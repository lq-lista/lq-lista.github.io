<!DOCTYPE html>
<html lang="pl">
<head>
    <!--#include virtual="/partials/head.html" -->
</head>
<body>
    <!-- Loader podczas ładowania aplikacji -->
    <div id="app-loading">
        <div class="loader"></div>
    </div>

    <div id="app">
        <!--#include virtual="/partials/header.html" -->
        <!--#include virtual="/partials/main-content.html" -->
        <!--#include virtual="/partials/footer.html" -->
        <!--#include virtual="/partials/order-modal.html" -->
        <!--#include virtual="/partials/admin-panel.html" -->
    </div>

    <!-- Skrypty JS -->
    <script src="/data.js"></script>
    <script src="/js/order/utils.js"></script>
    <script src="/js/order/firebase.js"></script>
    <script src="/js/order/statistics.js"></script>
    <script src="/js/order/orders.js"></script>
    <script src="/js/order/ui.js"></script>
    <script src="/js/order/core.js"></script>
    <script src="/js/order.js"></script>
    
    <script>
        // Funkcja do pokazywania błędów
        window.showError = function(message) {
            console.error(message);
            // Możesz dodać bardziej eleganckie powiadomienie UI
            alert(message);
        };

        // Bezpieczna aktualizacja roku
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const currentYearElement = document.getElementById('current-year');
                if (currentYearElement) {
                    currentYearElement.textContent = new Date().getFullYear();
                }
                
                setTimeout(() => {
                    const loader = document.getElementById('app-loading');
                    if (loader) {
                        loader.style.opacity = '0';
                        setTimeout(() => {
                            if (loader) {
                                loader.style.display = 'none';
                            }
                        }, 300);
                    }
                }, 500);
                
                // Bezpieczna obsługa kopiowania
                document.addEventListener('click', function(e) {
                    const copyBtn = e.target.closest('.copy-order-btn');
                    if (copyBtn) {
                        const orderNumberElement = document.getElementById('order-number');
                        if (!orderNumberElement || !orderNumberElement.textContent) return;
                        
                        const orderNumber = orderNumberElement.textContent;
                        const btnText = copyBtn.querySelector('.btn-text');
                        const btnIcon = copyBtn.querySelector('.btn-icon');
                        
                        navigator.clipboard.writeText(orderNumber).then(() => {
                            if (btnText) btnText.textContent = 'Skopiowano!';
                            if (btnIcon) btnIcon.textContent = '✔️';
                            copyBtn.classList.add('copied');
                            
                            setTimeout(() => {
                                if (btnText) btnText.textContent = 'Kopiuj';
                                if (btnIcon) btnIcon.textContent = '📋';
                                copyBtn.classList.remove('copied');
                            }, 2000);
                        }).catch(err => {
                            console.error('Błąd kopiowania:', err);
                            showError('Nie udało się skopiować numeru zamówienia');
                        });
                    }
                });
            } catch (error) {
                showError('Wystąpił błąd podczas inicjalizacji: ' + error.message);
            }
        });
    </script>
</body>
</html>